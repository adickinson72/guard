# Upgrade Specification Example (YAML)
#
# This file defines which fields to update during an Istio upgrade.
# You can use either YAML or JSON format.
#
# Usage:
#   igu run --batch prod-wave-1 --upgrade-spec upgrade-spec.yaml
#
# IMPORTANT - Fail-Fast Behavior:
# - All paths MUST exist in the target HelmRelease file
# - If a path doesn't exist, the upgrade will FAIL immediately
# - This prevents accidental configuration corruption from typos
# - Example: "spec.chart.speck.version" (typo) will FAIL instead of
#   silently creating a wrong field
# - To create new fields, ensure the parent path exists first

# Target version for the upgrade
version: "1.20.0"

# List of field updates to apply
# Each update specifies a dotted path and the value to set
updates:
  # Update the Helm chart version
  - path: "spec.chart.spec.version"
    value: "1.20.0"

  # Update the global image tag
  - path: "spec.values.global.tag"
    value: "1.20.0"

  # Update pilot configuration
  - path: "spec.values.pilot.autoscaleEnabled"
    value: true

  - path: "spec.values.pilot.autoscaleMin"
    value: 2

  - path: "spec.values.pilot.autoscaleMax"
    value: 5

  # Update resource requests
  - path: "spec.values.pilot.resources.requests.cpu"
    value: "500m"

  - path: "spec.values.pilot.resources.requests.memory"
    value: "512Mi"

  # Add new field for tracing
  - path: "spec.values.meshConfig.defaultConfig.tracing.zipkin.address"
    value: "zipkin.istio-system:9411"
